package io.mixeway.mixewayflowapi.domain.vulnerability;

import io.mixeway.mixewayflowapi.db.entity.Finding;
import io.mixeway.mixewayflowapi.db.entity.Vulnerability;
import io.mixeway.mixewayflowapi.db.repository.VulnerabilityRepository;
import io.mixeway.mixewayflowapi.exceptions.VulnerabilityException;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.Optional;

@Service
@RequiredArgsConstructor
public class GetOrCreateVulnerabilityService {
    private final VulnerabilityRepository vulnerabilityRepository;

    public Vulnerability getOrCreate(String name, String desc, String refs, String reco, Finding.Severity severity) {
        if (name == null) {
            throw new VulnerabilityException("Vulnerability name cannot be null");
        }

        return vulnerabilityRepository.findByName(name)
                .orElseGet(() -> vulnerabilityRepository.save(new Vulnerability(name, desc, refs, reco, severity)));
    }
}
