<!-- Enhanced Dashboard Header with Overview Stats -->
<c-row *ngIf="widgetStats" class="mb-4">
    <c-col>
        <app-widgets-dropdown [stats]="widgetStats"/>
    </c-col>
</c-row>

<!-- Admin Actions Bar - Conditionally shown -->
<c-row *ngIf="canManage" class="mb-4">
    <c-col>
        <c-card class="dashboard-actions-card">
            <c-card-header>
                <strong>Administrative Actions</strong>
            </c-card-header>
            <c-card-body class="d-flex gap-3">
                <button color="primary" cButton (click)="importRepoModal()">
                    <svg cIcon class="me-2" name="cil-code"></svg>
                    Bulk Repository Import
                </button>
                <button color="light" cButton (click)="importSingleRepoModal()">
                    <svg cIcon class="me-2" name="cil-clone"></svg>
                    Single Repository Import
                </button>
                <button color="info" cButton (click)="createNewTeamModal()">
                    <svg cIcon class="me-2" name="cil-people"></svg>
                    Add New Team
                </button>
            </c-card-body>
        </c-card>
    </c-col>
</c-row>

<!-- Main Dashboard Content -->
<c-row>
    <c-col xs="12">
        <c-card class="mb-4">
            <c-card-body>
                <c-tabs [activeItemKey]="0">
                    <!-- Tab Navigation -->
                    <c-tabs-list variant="underline-border">
                        <button cTab [itemKey]="0" class="px-4 py-3">
                            <svg cIcon name="cil-code" class="me-2"></svg>
                            Repositories
                        </button>
                        <button cTab [itemKey]="1" class="px-4 py-3">
                            <svg cIcon name="cil-cloud" class="me-2"></svg>
                            Cloud Subscriptions
                        </button>
                        <button cTab [itemKey]="2" class="px-4 py-3">
                            <svg cIcon name="cil-people" class="me-2"></svg>
                            Teams
                        </button>
                    </c-tabs-list>

                    <!-- Repositories Tab Content -->
                    <c-tabs-content>
                        <c-tab-panel class="p-3" [itemKey]="0">
                            <!-- Search & Filter -->
                            <c-row class="mb-4">
                                <c-col>
                                    <c-input-group class="dashboard-search-box">
                    <span cInputGroupText>
                      <svg cIcon name="cil-magnifying-glass"></svg>
                    </span>
                                        <input
                                                aria-label="Filter repositories"
                                                type="text"
                                                class="form-control"
                                                placeholder="Search repositories by name, team, or status..."
                                                (input)="updateFilter($event)"
                                        />
                                    </c-input-group>
                                </c-col>
                            </c-row>

                            <!-- Status Legend Toggle -->
                            <c-row class="mb-3">
                                <c-col>
                                    <button
                                            cButton
                                            color="light"
                                            size="sm"
                                            variant="ghost"
                                            class="mb-2"
                                            (click)="toggleStatusLegend()"
                                    >
                                        <svg cIcon name="cil-info" class="me-1"></svg>
                                        {{ showStatusLegend ? 'Hide Status Legend' : 'View Status Legend' }}
                                    </button>

                                    <!-- Collapsible Status Legend -->
                                    <div class="status-legend d-flex gap-4 align-items-center flex-wrap" *ngIf="showStatusLegend">
                                        <div class="legend-item d-flex align-items-center">
                                            <span class="status-indicator danger"></span>
                                            <small>Critical Issues</small>
                                        </div>
                                        <div class="legend-item d-flex align-items-center">
                                            <span class="status-indicator warning"></span>
                                            <small>Warnings</small>
                                        </div>
                                        <div class="legend-item d-flex align-items-center">
                                            <span class="status-indicator success"></span>
                                            <small>No Issues</small>
                                        </div>
                                        <div class="legend-item d-flex align-items-center">
                                            <span class="status-indicator neutral"></span>
                                            <small>Not Scanned</small>
                                        </div>
                                        <div class="legend-item d-flex align-items-center">
                                            <c-spinner size="sm"></c-spinner>
                                            <small class="ms-2">Running</small>
                                        </div>
                                    </div>
                                </c-col>
                            </c-row>

                            <!-- Data Table -->
                            <ngx-datatable
                                    class="bootstrap security-table"
                                    [rows]="rows"
                                    [columns]="columns"
                                    [columnMode]="'force'"
                                    [footerHeight]="50"
                                    [headerHeight]="50"
                                    [rowHeight]="'auto'"
                                    [limit]="10"
                            >
                                <!-- Action Column -->
                                <ngx-datatable-column name="" prop="name2" [width]="60" [sortable]="false" [resizeable]="false">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <button type="button" class="btn btn-sm btn-primary" (click)="click(row)">
                                            <svg cIcon name="cil-magnifying-glass"></svg>
                                        </button>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Target Column -->
                                <ngx-datatable-column name="Repository" prop="target" [width]="350">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">{{ row.target }}</span>
                                            <small class="text-muted">
                                                <a href="{{ row.repo_url }}" target="_blank" class="repo-link">
                                                    <svg cIcon name="cil-external-link" size="sm" class="me-1"></svg>{{ row.repo_url }}
                                                </a>
                                            </small>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Team Column -->
                                <ngx-datatable-column name="Team" prop="team" [width]="150">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <span class="team-badge">{{ row.team }}</span>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Security Scan Columns -->
                                <ngx-datatable-column name="SAST" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="Static Application Security Testing">SAST</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.sast === 'DANGER',
                          'success': row.sast === 'SUCCESS',
                          'warning': row.sast === 'WARNING',
                          'neutral': row.sast === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.sast === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.sast === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.sast === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.sast === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.sast === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- SCA Column -->
                                <ngx-datatable-column name="SCA" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="Software Composition Analysis">SCA</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.sca === 'DANGER',
                          'success': row.sca === 'SUCCESS',
                          'warning': row.sca === 'WARNING',
                          'neutral': row.sca === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.sca === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.sca === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.sca === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.sca === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.sca === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Secrets Column -->
                                <ngx-datatable-column name="Secrets" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="Secret Detection">Secrets</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.secrets === 'DANGER',
                          'success': row.secrets === 'SUCCESS',
                          'warning': row.secrets === 'WARNING',
                          'neutral': row.secrets === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.secrets === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.secrets === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.secrets === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.secrets === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.secrets === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- IaC Column -->
                                <ngx-datatable-column name="IaC" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="Infrastructure as Code">IaC</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.iac === 'DANGER',
                          'success': row.iac === 'SUCCESS',
                          'warning': row.iac === 'WARNING',
                          'neutral': row.iac === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.iac === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.iac === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.iac === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.iac === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.iac === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>
                            </ngx-datatable>
                        </c-tab-panel>
                    </c-tabs-content>

                    <!-- Cloud Subscriptions Tab Content -->
                    <c-tabs-content>
                        <c-tab-panel class="p-3" [itemKey]="1">
                            <!-- Search & Filter -->
                            <c-row class="mb-4">
                                <c-col>
                                    <c-input-group class="dashboard-search-box">
                    <span cInputGroupText>
                      <svg cIcon name="cil-magnifying-glass"></svg>
                    </span>
                                        <input
                                                aria-label="Filter cloud subscriptions"
                                                type="text"
                                                class="form-control"
                                                placeholder="Search cloud subscriptions..."
                                                (input)="updateCloudFilter($event)"
                                        />
                                    </c-input-group>
                                </c-col>
                            </c-row>

                            <!-- Data Table -->
                            <ngx-datatable
                                    class="bootstrap security-table"
                                    [rows]="cloudRows"
                                    [columns]="cloudColumns"
                                    [columnMode]="'force'"
                                    [footerHeight]="50"
                                    [headerHeight]="50"
                                    [rowHeight]="'auto'"
                                    [limit]="10"
                            >
                                <!-- Action Column -->
                                <ngx-datatable-column name="" prop="name2" [width]="60" [sortable]="false" [resizeable]="false">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <button type="button" class="btn btn-sm btn-primary" (click)="cloudClick(row)">
                                            <svg cIcon name="cil-magnifying-glass"></svg>
                                        </button>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Cloud Subscription Column -->
                                <ngx-datatable-column name="Cloud Subscription" prop="cloudSubscription" [width]="350">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">{{ row.externalProjectName }}</span>
                                            <small class="text-muted">{{ row.cloudSubscription }}</small>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Team Column -->
                                <ngx-datatable-column name="Team" prop="team" [width]="150">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <span class="team-badge">{{ row.team }}</span>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Cloud Scan Status Column -->
                                <ngx-datatable-column name="Cloud Security" [width]="150">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.scanStatus === 'DANGER',
                          'success': row.scanStatus === 'SUCCESS',
                          'warning': row.scanStatus === 'WARNING',
                          'neutral': row.scanStatus === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.scanStatus === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.scanStatus === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.scanStatus === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.scanStatus === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.scanStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>
                            </ngx-datatable>
                        </c-tab-panel>
                    </c-tabs-content>

                    <!-- Teams Tab Content -->
                    <c-tabs-content>
                        <c-tab-panel class="p-3" [itemKey]="2">
                            <!-- Search & Filter -->
                            <c-row class="mb-4">
                                <c-col>
                                    <c-input-group class="dashboard-search-box">
                    <span cInputGroupText>
                      <svg cIcon name="cil-magnifying-glass"></svg>
                    </span>
                                        <input
                                                aria-label="Filter teams"
                                                type="text"
                                                class="form-control"
                                                placeholder="Search teams..."
                                                (input)="updateTeamsFilter($event)"
                                        />
                                    </c-input-group>
                                </c-col>
                            </c-row>

                            <!-- Data Table -->
                            <ngx-datatable
                                    class="bootstrap security-table"
                                    [rows]="teams"
                                    [columns]="teamsColumns"
                                    [columnMode]="'force'"
                                    [footerHeight]="50"
                                    [headerHeight]="50"
                                    [rowHeight]="'auto'"
                                    [limit]="10"
                            >
                                <!-- Action Column -->
                                <ngx-datatable-column name="" prop="name2" [width]="60" [sortable]="false" [resizeable]="false">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <button type="button" class="btn btn-sm btn-primary" (click)="teamClick(row)">
                                            <svg cIcon name="cil-magnifying-glass"></svg>
                                        </button>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Team Name Column -->
                                <ngx-datatable-column name="Team" prop="name" [width]="250">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">{{ row.name }}</span>
                                            <small class="text-muted">{{ row.remoteIdentifier }}</small>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Members Column -->
                                <ngx-datatable-column name="Members" [width]="150" [sortable]="false">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="team-members-count">
                                            <svg cIcon name="cil-user" class="me-1"></svg>
                                            {{ row.users?.length || 0 }} member<span *ngIf="row.users?.length !== 1">s</span>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <!-- Security Status Columns -->
                                <ngx-datatable-column name="SAST" [width]="100">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.sastStatus === 'DANGER',
                          'success': row.sastStatus === 'SUCCESS',
                          'warning': row.sastStatus === 'WARNING',
                          'neutral': row.sastStatus === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.sastStatus === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.sastStatus === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.sastStatus === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.sastStatus === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.sastStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="SCA" [width]="100">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.scaStatus === 'DANGER',
                          'success': row.scaStatus === 'SUCCESS',
                          'warning': row.scaStatus === 'WARNING',
                          'neutral': row.scaStatus === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.scaStatus === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.scaStatus === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.scaStatus === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.scaStatus === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.scaStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Secrets" [width]="100">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.secretsStatus === 'DANGER',
                          'success': row.secretsStatus === 'SUCCESS',
                          'warning': row.secretsStatus === 'WARNING',
                          'neutral': row.secretsStatus === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.secretsStatus === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.secretsStatus === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.secretsStatus === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.secretsStatus === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.secretsStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="IaC" [width]="100">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.iacStatus === 'DANGER',
                          'success': row.iacStatus === 'SUCCESS',
                          'warning': row.iacStatus === 'WARNING',
                          'neutral': row.iacStatus === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.iacStatus === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.iacStatus === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.iacStatus === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.iacStatus === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.iacStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Cloud" [width]="100">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                          'danger': row.cloudScanStatus === 'DANGER',
                          'success': row.cloudScanStatus === 'SUCCESS',
                          'warning': row.cloudScanStatus === 'WARNING',
                          'neutral': row.cloudScanStatus === 'NOT_PERFORMED'
                        }"
                                            >
                                                <svg *ngIf="row.cloudScanStatus === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.cloudScanStatus === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.cloudScanStatus === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.cloudScanStatus === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.cloudScanStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>
                            </ngx-datatable>
                        </c-tab-panel>
                    </c-tabs-content>
                </c-tabs>
            </c-card-body>
        </c-card>
    </c-col>
</c-row>

<!-- Import Repository Modal -->
<c-modal id="importRepoModal" alignment="center" [visible]="visible" (visibleChange)="handleImportRepoChange($event)">
    <c-modal-header>
        <h5 cModalTitle>Import Repositories</h5>
    </c-modal-header>
    <c-modal-body>
        <!-- Repository Type Selection -->
        <div class="repo-type-selector mb-4">
            <h6 class="mb-3">Select Repository Type</h6>
            <div class="d-flex justify-content-center gap-4">
                <button
                        cButton
                        type="button"
                        class="repo-type-btn"
                        [class.active]="selectedRepo === 'GitLab'"
                        (click)="selectRepoType('GitLab')"
                        cTooltip="Import from GitLab"
                        cTooltipPlacement="top"
                >
                    <svg cIcon name="cib-gitlab" size="3xl"></svg>
                    <span class="repo-type-label">GitLab</span>
                </button>
                <button
                        cButton
                        type="button"
                        class="repo-type-btn"
                        [class.active]="selectedRepo === 'GitHub'"
                        (click)="selectRepoType('GitHub')"
                        cTooltip="Import from GitHub"
                        cTooltipPlacement="top"
                >
                    <svg cIcon name="cib-github" size="3xl"></svg>
                    <span class="repo-type-label">GitHub</span>
                </button>
            </div>
        </div>

        <!-- Import Repository Form -->
        <form [formGroup]="importRepoForm" cForm>
            <div class="mb-3">
                <label for="repoUrl" class="form-label">Repository URL</label>
                <c-input-group class="has-validation">
          <span cInputGroupText>
            <svg cIcon name="cil-link"></svg>
          </span>
                    <input
                            cFormControl
                            type="url"
                            id="repoUrl"
                            formControlName="repoUrl"
                            placeholder="https://gitlab.com/your-group"
                            required
                    />
                    <div class="invalid-feedback" *ngIf="importRepoForm.get('repoUrl')?.invalid && importRepoForm.get('repoUrl')?.touched">
                        Please enter a valid URL
                    </div>
                </c-input-group>
            </div>

            <div class="mb-3">
                <label for="accessToken" class="form-label">Access Token</label>
                <c-input-group class="has-validation">
          <span cInputGroupText>
            <svg cIcon name="cil-lock-locked"></svg>
          </span>
                    <input
                            cFormControl
                            type="password"
                            id="accessToken"
                            formControlName="accessToken"
                            placeholder="Your access token"
                            required
                    />
                    <div class="invalid-feedback" *ngIf="importRepoForm.get('accessToken')?.invalid && importRepoForm.get('accessToken')?.touched">
                        Access token is required
                    </div>
                </c-input-group>
            </div>

            <div class="mb-3">
                <label for="inputGroupSelect01" class="form-label">Team</label>
                <c-input-group class="has-validation">
          <span cInputGroupText>
            <svg cIcon name="cil-people"></svg>
          </span>
                    <select cSelect id="inputGroupSelect01" formControlName="team" required>
                        <option value="" disabled selected>Select Team...</option>
                        <option *ngFor="let team of teams" [value]="team.id">{{ team.name }}</option>
                    </select>
                    <div class="invalid-feedback" *ngIf="importRepoForm.get('team')?.invalid && importRepoForm.get('team')?.touched">
                        Please select a team
                    </div>
                </c-input-group>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="closeModal()" cButton color="secondary">Cancel</button>
        <button (click)="onSubmit()" cButton color="primary" [disabled]="importRepoForm.invalid">
            <svg cIcon name="cil-cloud-download" class="me-1"></svg> Browse Repositories
        </button>
    </c-modal-footer>
</c-modal>

<!-- Repository List Modal -->
<c-modal size="xl" id="repoListModal" alignment="center" [visible]="visibleList" (visibleChange)="handleListRepoChange($event)">
    <c-modal-header>
        <h5 cModalTitle>Available Repositories</h5>
    </c-modal-header>
    <c-modal-body>
        <!-- Loading State -->
        <div *ngIf="isLoading" class="text-center p-5">
            <c-spinner color="primary" size="sm"></c-spinner>
            <p class="mt-3">Loading repositories...</p>
        </div>

        <!-- Repository List -->
        <ng-container *ngIf="!isLoading">
            <!-- Filter Input -->
            <c-input-group class="mb-4">
        <span cInputGroupText>
          <svg cIcon name="cil-magnifying-glass"></svg>
        </span>
                <input
                        type="text"
                        class="form-control"
                        placeholder="Filter repositories..."
                        (input)="updateFilterRepo($event)"
                />
            </c-input-group>

            <!-- Repository Table -->
            <ngx-datatable
                    class="bootstrap"
                    [rows]="repoRows"
                    [columnMode]="'force'"
                    [footerHeight]="50"
                    [headerHeight]="50"
                    [rowHeight]="'auto'"
                    [limit]="10"
            >
                <ngx-datatable-column name="Name" prop="name"></ngx-datatable-column>
                <ngx-datatable-column name="Namespace" prop="namespace"></ngx-datatable-column>
                <ngx-datatable-column name="URL" prop="repo_url"></ngx-datatable-column>
                <ngx-datatable-column name="Import" [width]="80" [sortable]="false">
                    <ng-template ngx-datatable-cell-template let-row="row">
                        <button *ngIf="!row.imported" cButton color="primary" size="sm" (click)="importRepo(row)">
                            <svg cIcon name="cil-cloud-download"></svg>
                        </button>
                        <button *ngIf="row.imported" cButton color="success" size="sm" disabled>
                            <svg cIcon name="cil-check"></svg>
                        </button>
                    </ng-template>
                </ngx-datatable-column>
            </ngx-datatable>
        </ng-container>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="closeModal()" cButton color="primary">Done</button>
    </c-modal-footer>
</c-modal>

<!-- Single Repository Import Modal -->
<c-modal id="importSingleRepoModal" alignment="center" [visible]="visibleSingleRepoModal" (visibleChange)="handleImportSingleRepoChange($event)">
    <c-modal-header>
        <h5 cModalTitle>Import Single Repository</h5>
    </c-modal-header>
    <c-modal-body>
        <!-- Repository Type Selection -->
        <div class="repo-type-selector mb-4">
            <h6 class="mb-3">Select Repository Type</h6>
            <div class="d-flex justify-content-center gap-4">
                <button
                        cButton
                        type="button"
                        class="repo-type-btn"
                        [class.active]="selectedRepo === 'GitLab'"
                        (click)="selectRepoType('GitLab')"
                        cTooltip="Import from GitLab"
                        cTooltipPlacement="top"
                >
                    <svg cIcon name="cib-gitlab" size="3xl"></svg>
                    <span class="repo-type-label">GitLab</span>
                </button>
                <button
                        cButton
                        type="button"
                        class="repo-type-btn"
                        [class.active]="selectedRepo === 'GitHub'"
                        (click)="selectRepoType('GitHub')"
                        cTooltip="Import from GitHub"
                        cTooltipPlacement="top"
                >
                    <svg cIcon name="cib-github" size="3xl"></svg>
                    <span class="repo-type-label">GitHub</span>
                </button>
            </div>
        </div>

        <!-- Import Single Repository Form -->
        <form [formGroup]="importSingleRepoForm" cForm>
            <div class="mb-3">
                <label for="repoUrl2" class="form-label">Repository URL</label>
                <c-input-group class="has-validation">
          <span cInputGroupText>
            <svg cIcon name="cil-link"></svg>
          </span>
                    <input
                            cFormControl
                            type="url"
                            id="repoUrl2"
                            formControlName="repoUrl"
                            placeholder="https://gitlab.com/org/project"
                            required
                    />
                    <div class="invalid-feedback" *ngIf="importSingleRepoForm.get('repoUrl')?.invalid && importSingleRepoForm.get('repoUrl')?.touched">
                        Please enter a valid repository URL
                    </div>
                </c-input-group>
                <small class="text-muted">Enter the direct URL to your repository</small>
            </div>

            <div class="mb-3">
                <label for="accessToken2" class="form-label">Access Token</label>
                <c-input-group class="has-validation">
          <span cInputGroupText>
            <svg cIcon name="cil-lock-locked"></svg>
          </span>
                    <input
                            cFormControl
                            type="password"
                            id="accessToken2"
                            formControlName="accessToken"
                            placeholder="Your access token"
                            required
                    />
                    <div class="invalid-feedback" *ngIf="importSingleRepoForm.get('accessToken')?.invalid && importSingleRepoForm.get('accessToken')?.touched">
                        Access token is required
                    </div>
                </c-input-group>
            </div>

            <div class="mb-3">
                <label for="inputGroupSelect02" class="form-label">Team</label>
                <c-input-group class="has-validation">
          <span cInputGroupText>
            <svg cIcon name="cil-people"></svg>
          </span>
                    <select cSelect id="inputGroupSelect02" formControlName="team" required>
                        <option value="" disabled selected>Select Team...</option>
                        <option *ngFor="let team of teams" [value]="team.id">{{ team.name }}</option>
                    </select>
                    <div class="invalid-feedback" *ngIf="importSingleRepoForm.get('team')?.invalid && importSingleRepoForm.get('team')?.touched">
                        Please select a team
                    </div>
                </c-input-group>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="closeModal()" cButton color="secondary">Cancel</button>
        <button (click)="onSubmitSingleRepo()" cButton color="primary" [disabled]="importSingleRepoForm.invalid">
            <svg cIcon name="cil-cloud-download" class="me-1"></svg> Import Repository
        </button>
    </c-modal-footer>
</c-modal>

<!-- Add New Team Modal -->
<c-modal id="newTeamModal" alignment="center" [visible]="visibleNewTeam" (visibleChange)="handleNewTeam($event)">
    <c-modal-header>
        <h5 cModalTitle>Add New Team</h5>
    </c-modal-header>
    <c-modal-body>
        <form [formGroup]="newTeamForm" cForm>
            <div class="mb-3">
                <label for="teamName" class="form-label">Team Name</label>
                <c-input-group class="has-validation">
          <span cInputGroupText>
            <svg cIcon name="cil-people"></svg>
          </span>
                    <input
                            cFormControl
                            type="text"
                            id="teamName"
                            formControlName="name"
                            placeholder="Enter team name"
                            required
                    />
                    <div class="invalid-feedback" *ngIf="newTeamForm.get('name')?.invalid && newTeamForm.get('name')?.touched">
                        Team name is required
                    </div>
                </c-input-group>
            </div>

            <div class="mb-3">
                <label for="remoteIdentifier" class="form-label">Remote Identifier (Optional)</label>
                <c-input-group>
          <span cInputGroupText>
            <svg cIcon name="cil-blur"></svg>
          </span>
                    <input
                            cFormControl
                            type="text"
                            id="remoteIdentifier"
                            formControlName="remoteIdentifier"
                            placeholder="Remote identifier (optional)"
                    />
                </c-input-group>
                <small class="text-muted">Used for mapping to external systems</small>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="closeNewTeamModal()" cButton color="secondary">Cancel</button>
        <button (click)="onSubmitNewTeam()" cButton color="primary" [disabled]="newTeamForm.invalid">
            <svg cIcon name="cil-plus" class="me-1"></svg> Create Team
        </button>
    </c-modal-footer>
</c-modal>

<!-- Notification Toast -->
<c-toaster [placement]="position" class="p-3" position="fixed">
    <c-toast
            [color]="toastStatus"
            (visibleChange)="onVisibleChange($event)"
            [visible]="visibleToast"
            [autohide]="true"
            [delay]="5000"
    >
        <c-toast-header>
            <svg cIcon name="cil-bell" class="me-2"></svg>
            <strong>Notification</strong>
        </c-toast-header>
        <c-toast-body>
            <p class="mb-0">{{ toastMessage }}</p>
        </c-toast-body>
    </c-toast>
</c-toaster>