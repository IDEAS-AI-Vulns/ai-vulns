<c-row *ngIf="widgetStats && !showSecurityOverview" class="mb-4">
    <c-col>
        <app-widgets-dropdown [stats]="widgetStats"/>
    </c-col>
</c-row>

<c-row class="mb-4">
    <c-col>
        <c-card class="security-overview-card">
            <c-card-header class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>Security & Performance Overview</strong>
                    <small class="text-muted ms-2">Key metrics across your organization</small>
                </div>
                <button color="link" cButton variant="ghost" class="p-0" (click)="toggleSecurityOverview()">
                    <svg cIcon [name]="showSecurityOverview ? 'cil-chevron-top' : 'cil-chevron-bottom'"></svg>
                </button>
            </c-card-header>
            <c-card-body *ngIf="showSecurityOverview">
                <c-row class="g-3 mb-4">
                    <c-col md="6" lg="3">
                        <div class="security-summary-card d-flex align-items-center p-3 h-100 rounded">
                            <div class="summary-icon total-icon me-3">
                                <svg cIcon name="cil-list" size="xl" class="text-white"></svg>
                            </div>
                            <div class="summary-data">
                                <div class="summary-title text-muted">Total Open Findings</div>
                                <div class="summary-value fs-4 fw-bold">{{ securityStats?.openTotal || '0' }}</div>
                                <div class="summary-trend d-flex align-items-center">
                                    <svg cIcon [name]="getSecurityTrendIcon('total')" class="me-1" size="sm"></svg>
                                    <span [ngClass]="getSecurityTrendClass('total')">
                                        {{ getSecurityTrendText('total') }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </c-col>

                    <c-col md="6" lg="3">
                        <div class="security-summary-card d-flex align-items-center p-3 h-100 rounded">
                            <div class="summary-icon critical-icon me-3">
                                <svg cIcon name="cil-warning" size="xl" class="text-white"></svg>
                            </div>
                            <div class="summary-data">
                                <div class="summary-title text-muted">Critical Findings</div>
                                <div class="summary-value fs-4 fw-bold">{{ securityStats?.criticalTotal || '0' }}</div>
                                <div class="summary-trend d-flex align-items-center">
                                    <svg cIcon [name]="getSecurityTrendIcon('critical')" class="me-1" size="sm"></svg>
                                    <span [ngClass]="getSecurityTrendClass('critical')">
                                        {{ getSecurityTrendText('critical') }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </c-col>

                    <c-col md="6" lg="3">
                        <div class="security-summary-card d-flex align-items-center p-3 h-100 rounded">
                            <div class="summary-icon fix-time-icon me-3">
                                <svg cIcon name="cil-clock" size="xl" class="text-white"></svg>
                            </div>
                            <div class="summary-data">
                                <div class="summary-title text-muted">Avg. Fix Time</div>
                                <div class="summary-value fs-4 fw-bold">{{ securityStats?.averageFixTime || '0' }}
                                    days
                                </div>
                                <div class="summary-trend d-flex align-items-center">
                                    <span class="text-muted">Current statistics</span>
                                </div>
                            </div>
                        </div>
                    </c-col>

                    <c-col md="6" lg="3">
                        <div class="security-summary-card d-flex align-items-center p-3 h-100 rounded">
                            <div class="summary-icon score-icon me-3">
                                <svg cIcon name="cil-storage" size="xl" class="text-white"></svg>
                            </div>
                            <div class="summary-data">
                                <div class="summary-title text-muted">Total Repositories</div>
                                <div class="summary-value fs-4 fw-bold">{{ securityStats?.totalRepos || '0' }}</div>
                                <div class="summary-trend d-flex align-items-center">
                                    <a [routerLink]="['/security-dashboard']" class="text-decoration-none">
                                        View details
                                        <svg cIcon name="cil-arrow-right" size="sm"></svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </c-col>
                </c-row>

                <c-row class="g-3 mb-4" *ngIf="widgetStats">
                    <c-col md="6" lg="3">
                        <div class="security-summary-card d-flex align-items-center p-3 h-100 rounded">
                            <div class="summary-icon team-icon me-3">
                                <svg cIcon name="cil-people" size="xl" class="text-white"></svg>
                            </div>
                            <div class="summary-data">
                                <div class="summary-title text-muted">Monitored Teams</div>
                                <div class="summary-value fs-4 fw-bold">{{ widgetStats?.teams || '0' }}</div>
                                <div class="summary-trend d-flex align-items-center">
                                    <span class="text-muted">Active teams</span>
                                </div>
                            </div>
                        </div>
                    </c-col>

                    <c-col md="6" lg="3">
                        <div class="security-summary-card d-flex align-items-center p-3 h-100 rounded">
                            <div class="summary-icon scan-icon me-3">
                                <svg cIcon name="cil-magnifying-glass" size="xl" class="text-white"></svg>
                            </div>
                            <div class="summary-data">
                                <div class="summary-title text-muted">Total Scans</div>
                                <div class="summary-value fs-4 fw-bold">{{ widgetStats?.totalScans || '0' }}</div>
                                <div class="summary-trend d-flex align-items-center">
                                    <span class="text-muted">All-time scans</span>
                                </div>
                            </div>
                        </div>
                    </c-col>

                    <c-col md="6" lg="3">
                        <div class="security-summary-card d-flex align-items-center p-3 h-100 rounded">
                            <div class="summary-icon monthly-icon me-3">
                                <svg cIcon name="cil-calendar" size="xl" class="text-white"></svg>
                            </div>
                            <div class="summary-data">
                                <div class="summary-title text-muted">Monthly Scans</div>
                                <div class="summary-value fs-4 fw-bold">{{ widgetStats?.monthlyScans || '0' }}</div>
                                <div class="summary-trend d-flex align-items-center">
                                    <span class="text-muted">Last 30 days</span>
                                </div>
                            </div>
                        </div>
                    </c-col>

                    <c-col md="6" lg="3">
                        <div class="security-summary-card d-flex align-items-center p-3 h-100 rounded">
                            <div class="summary-icon grade-icon me-3">
                                <svg cIcon name="cil-shield-alt" size="xl" class="text-white"></svg>
                            </div>
                            <div class="summary-data">
                                <div class="summary-title text-muted">Security Score</div>
                                <div class="summary-value fs-4 fw-bold">{{ calculateSecurityScore() }}</div>
                                <div class="summary-trend d-flex align-items-center">
                                    <a [routerLink]="['/stats']" class="text-decoration-none">
                                        View details
                                        <svg cIcon name="cil-arrow-right" size="sm"></svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </c-col>
                </c-row>

                <c-row>
                    <c-col>
                        <div class="chart-container p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">
                                    <svg cIcon name="cil-chart-line" class="me-2 text-primary" width="16"></svg>
                                    Vulnerability Trend (Last 30 Days)
                                </h6>
                                <a [routerLink]="['/security-dashboard']"
                                   class="btn btn-sm btn-link text-decoration-none">
                                    Details
                                    <svg cIcon name="cil-arrow-right" size="sm"></svg>
                                </a>
                            </div>
                            <div style="height: 240px; padding-bottom: 20px; position: relative; overflow: hidden;">
                                <c-chart *ngIf="vulnerabilityTrendData"
                                         type="line"
                                         [data]="vulnerabilityTrendData"
                                         [options]="chartOptions"
                                         style="max-height: 100%; width: 100%;">
                                </c-chart>
                                <div *ngIf="!vulnerabilityTrendData && !trendDataLoaded"
                                     class="d-flex justify-content-center align-items-center h-100">
                                    <c-spinner color="primary" size="sm" class="me-2"></c-spinner>
                                    <span>Loading chart data...</span>
                                </div>
                                <div *ngIf="!vulnerabilityTrendData && trendDataLoaded"
                                     class="d-flex justify-content-center align-items-center h-100 flex-column">
                                    <svg cIcon name="cil-chart-line" class="text-muted mb-2" width="24"
                                         height="24"></svg>
                                    <span class="text-muted">No trend data available</span>
                                    <small class="text-muted mt-1">Run security scans to generate trend data</small>
                                </div>
                            </div>
                        </div>
                    </c-col>
                </c-row>
            </c-card-body>
        </c-card>
    </c-col>
</c-row>

<c-row *ngIf="canManage" class="mb-4">
    <c-col>
        <c-card class="dashboard-actions-card">
            <c-card-header>
                <strong>Administrative Actions</strong>
            </c-card-header>
            <c-card-body class="d-flex flex-wrap gap-3">
                <button color="primary" cButton (click)="importRepoModal()"
                        cTooltip="Import multiple repositories from a Git provider">
                    <svg cIcon class="me-2" name="cil-code"></svg>
                    Bulk Repository Import
                </button>
                <button color="light" cButton (click)="importSingleRepoModal()"
                        cTooltip="Import a single specific repository">
                    <svg cIcon class="me-2" name="cil-clone"></svg>
                    Single Repository Import
                </button>
                <button color="info" cButton (click)="createNewTeamModal()"
                        *ngIf="appInfo?.quotaInfo?.planType != 'FREE'" cTooltip="Create a new team">
                    <svg cIcon class="me-2" name="cil-people"></svg>
                    Add New Team
                </button>
                <button color="success" cButton (click)="connectProviderModal()"
                        *ngIf="role=='ADMIN'" cTooltip="Connect to a Git provider to sync all repositories">
                    <svg cIcon class="me-2" name="cil-sync"></svg>
                    Connect Repository Provider
                </button>
                <button *ngIf="selectedRepos.length > 0 && isAdmin" cButton color="primary" (click)="openChangeTeamModal()">
                    <svg cIcon name="cil-pencil" class="me-2"></svg>
                    Edit Selected ({{ selectedRepos.length }})
                </button>
            </c-card-body>
        </c-card>
    </c-col>
</c-row>

<c-row>
    <c-col xs="12">
        <c-card class="mb-4">
            <c-card-body>
                <c-tabs [activeItemKey]="0">
                    <c-tabs-list variant="underline-border">
                        <button cTab [itemKey]="0" class="px-4 py-3">
                            <svg cIcon name="cil-code" class="me-2"></svg>
                            Repositories
                        </button>
                        <button cTab [itemKey]="1" class="px-4 py-3">
                            <svg cIcon name="cil-cloud" class="me-2"></svg>
                            Cloud Subscriptions
                        </button>
                        <button cTab [itemKey]="2" class="px-4 py-3">
                            <svg cIcon name="cil-people" class="me-2"></svg>
                            Teams
                        </button>
                        <button cTab [itemKey]="3" class="px-4 py-3" *ngIf="isAdmin">
                            <svg cIcon name="cil-cloud" class="me-2"></svg>
                            Repository Providers
                        </button>
                    </c-tabs-list>

                    <c-tabs-content>
                        <c-tab-panel class="p-3" [itemKey]="0">
                            <c-row class="mb-4">
                                <c-col>
                                    <c-input-group class="dashboard-search-box">
                                        <span cInputGroupText>
                                          <svg cIcon name="cil-magnifying-glass"></svg>
                                        </span>
                                        <input
                                                aria-label="Filter repositories"
                                                type="text"
                                                class="form-control"
                                                placeholder="Search repositories by name, team, or status..."
                                                (input)="updateFilter($event)"
                                        />
                                    </c-input-group>
                                </c-col>
                            </c-row>

                            <c-row class="mb-3">
                                <c-col>
                                    <button
                                            cButton
                                            color="light"
                                            size="sm"
                                            variant="ghost"
                                            class="mb-2"
                                            (click)="toggleStatusLegend()"
                                    >
                                        <svg cIcon name="cil-info" class="me-1"></svg>
                                        {{ showStatusLegend ? 'Hide Status Legend' : 'View Status Legend' }}
                                    </button>

                                    <div class="status-legend d-flex gap-4 align-items-center flex-wrap"
                                         *ngIf="showStatusLegend">
                                        <div class="legend-item d-flex align-items-center">
                                            <span class="status-indicator danger"></span>
                                            <small>Critical Issues</small>
                                        </div>
                                        <div class="legend-item d-flex align-items-center">
                                            <span class="status-indicator warning"></span>
                                            <small>Warnings</small>
                                        </div>
                                        <div class="legend-item d-flex align-items-center">
                                            <span class="status-indicator success"></span>
                                            <small>No Issues</small>
                                        </div>
                                        <div class="legend-item d-flex align-items-center">
                                            <span class="status-indicator neutral"></span>
                                            <small>Not Scanned</small>
                                        </div>
                                        <div class="legend-item d-flex align-items-center">
                                            <c-spinner size="sm"></c-spinner>
                                            <small class="ms-2">Running</small>
                                        </div>
                                    </div>
                                </c-col>
                            </c-row>

                            <ngx-datatable
                                    class="bootstrap security-table"
                                    [rows]="rows"
                                    [columns]="columns"
                                    [selectionType]="selectionType.multiClick"
                                    (select)="onSelect($event)"
                                    [selected]="selectedRepos"
                                    [rowIdentity]="rowIdentity"
                                    [selectAllRowsOnPage]="false"
                                    [columnMode]="'force'"
                                    [footerHeight]="50"
                                    [headerHeight]="50"
                                    [rowHeight]="'auto'"
                                    [limit]="10">

                                <ngx-datatable-column name="" prop="name2" [width]="60" [sortable]="false" [resizeable]="false">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <button type="button" class="btn btn-sm btn-primary" (click)="click(row)">
                                            <svg cIcon name="cil-magnifying-glass"></svg>
                                        </button>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Repository" prop="target" [width]="350">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">{{ row.target }}</span>
                                            <small class="text-muted">
                                                <a href="{{ row.repo_url }}" target="_blank" class="repo-link">
                                                    <svg cIcon name="cil-external-link" size="sm" class="me-1"></svg>
                                                    {{ row.repo_url }}
                                                </a>
                                            </small>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Team" prop="team" [width]="150">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <span class="team-badge">{{ row.team }}</span>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Security Posture" [width]="320" [sortable]="false">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="d-flex align-items-center security-posture-cell">

                                            <div class="overall-risk-indicator me-3" [cTooltip]="'Overall Risk: ' + getOverallRiskStatus(row)">
                                                <svg cIcon [name]="getOverallRiskIcon(row)" size="lg"
                                                     [ngClass]="getOverallRiskClass(row)"></svg>
                                            </div>

                                            <div class="scan-health-bar d-flex flex-wrap gap-1">
                                                <div class="scan-block" [cTooltip]="'SAST: ' + row.sast" [ngClass]="getScanStatusClass(row.sast)">SAST</div>
                                                <div class="scan-block" [cTooltip]="'DAST: ' + row.dast" [ngClass]="getScanStatusClass(row.dast)">DAST</div>
                                                <div class="scan-block" [cTooltip]="'SCA: ' + row.sca" [ngClass]="getScanStatusClass(row.sca)">SCA</div>
                                                <div class="scan-block" [cTooltip]="'Secrets: ' + row.secrets" [ngClass]="getScanStatusClass(row.secrets)">SECR</div>
                                                <div class="scan-block" [cTooltip]="'IaC: ' + row.iac" [ngClass]="getScanStatusClass(row.iac)">IAC</div>
                                                <div class="scan-block" [cTooltip]="'GitLab: ' + row.gitlab" [ngClass]="getScanStatusClass(row.gitlab)">GIT</div>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                            </ngx-datatable>
                        </c-tab-panel>
                    </c-tabs-content>

                    <c-tabs-content>
                        <c-tab-panel class="p-3" [itemKey]="1">
                            <c-row class="mb-4">
                                <c-col>
                                    <c-input-group class="dashboard-search-box">
                    <span cInputGroupText>
                      <svg cIcon name="cil-magnifying-glass"></svg>
                    </span>
                                        <input
                                                aria-label="Filter cloud subscriptions"
                                                type="text"
                                                class="form-control"
                                                placeholder="Search cloud subscriptions..."
                                                (input)="updateCloudFilter($event)"
                                        />
                                    </c-input-group>
                                </c-col>
                            </c-row>

                            <ngx-datatable
                                    class="bootstrap security-table"
                                    [rows]="cloudRows"
                                    [columns]="cloudColumns"
                                    [columnMode]="'force'"
                                    [footerHeight]="50"
                                    [headerHeight]="50"
                                    [rowHeight]="'auto'"
                                    [limit]="10"
                            >
                                <ngx-datatable-column name="" prop="name2" [width]="60" [sortable]="false"
                                                      [resizeable]="false">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <button type="button" class="btn btn-sm btn-primary" (click)="cloudClick(row)">
                                            <svg cIcon name="cil-magnifying-glass"></svg>
                                        </button>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Cloud Subscription" prop="cloudSubscription" [width]="350">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">{{ row.externalProjectName }}</span>
                                            <small class="text-muted">{{ row.cloudSubscription }}</small>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Team" prop="team" [width]="150">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <span class="team-badge">{{ row.team }}</span>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Cloud Scan" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="Cloud Security Scan">Cloud Scan</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                                'danger': row.scanStatus === 'DANGER',
                                'success': row.scanStatus === 'SUCCESS',
                                'warning': row.scanStatus === 'WARNING',
                                'neutral': row.scanStatus === 'NOT_PERFORMED'
                              }"
                                            >
                                                <svg *ngIf="row.scanStatus === 'DANGER'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.scanStatus === 'SUCCESS'" cIcon name="cil-check"
                                                     size="md"></svg>
                                                <svg *ngIf="row.scanStatus === 'WARNING'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.scanStatus === 'NOT_PERFORMED'" cIcon name="cil-ban"
                                                     size="md"></svg>
                                                <c-spinner *ngIf="row.scanStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>
                            </ngx-datatable>
                        </c-tab-panel>
                    </c-tabs-content>

                    <c-tabs-content>
                        <c-tab-panel class="p-3" [itemKey]="2">
                            <c-row class="mb-4">
                                <c-col>
                                    <c-input-group class="dashboard-search-box">
                    <span cInputGroupText>
                      <svg cIcon name="cil-magnifying-glass"></svg>
                    </span>
                                        <input
                                                aria-label="Filter teams"
                                                type="text"
                                                class="form-control"
                                                placeholder="Search teams..."
                                                (input)="updateTeamsFilter($event)"
                                        />
                                    </c-input-group>
                                </c-col>
                            </c-row>

                            <ngx-datatable
                                    class="bootstrap security-table"
                                    [rows]="teams"
                                    [columns]="teamsColumns"
                                    [columnMode]="'force'"
                                    [footerHeight]="50"
                                    [headerHeight]="50"
                                    [rowHeight]="'auto'"
                                    [limit]="10"
                            >
                                <ngx-datatable-column name="" prop="name2" [width]="60" [sortable]="false"
                                                      [resizeable]="false">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <button type="button" class="btn btn-sm btn-primary" (click)="teamClick(row)">
                                            <svg cIcon name="cil-magnifying-glass"></svg>
                                        </button>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Team" prop="name" [width]="350">
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">{{ row.name }}</span>
                                            <small class="text-muted">{{ row.remoteIdentifier }}</small>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="SAST" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="Static Application Security Testing">SAST</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                                'danger': row.sastStatus === 'DANGER',
                                'success': row.sastStatus === 'SUCCESS',
                                'warning': row.sastStatus === 'WARNING',
                                'neutral': row.sastStatus === 'NOT_PERFORMED'
                              }"
                                            >
                                                <svg *ngIf="row.sastStatus === 'DANGER'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.sastStatus === 'SUCCESS'" cIcon name="cil-check"
                                                     size="md"></svg>
                                                <svg *ngIf="row.sastStatus === 'WARNING'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.sastStatus === 'NOT_PERFORMED'" cIcon name="cil-ban"
                                                     size="md"></svg>
                                                <c-spinner *ngIf="row.sastStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="SCA" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header"
                                              cTooltip="Software Composition Analysis">SCA</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                                'danger': row.scaStatus === 'DANGER',
                                'success': row.scaStatus === 'SUCCESS',
                                'warning': row.scaStatus === 'WARNING',
                                'neutral': row.scaStatus === 'NOT_PERFORMED'
                              }"
                                            >
                                                <svg *ngIf="row.scaStatus === 'DANGER'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.scaStatus === 'SUCCESS'" cIcon name="cil-check"
                                                     size="md"></svg>
                                                <svg *ngIf="row.scaStatus === 'WARNING'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.scaStatus === 'NOT_PERFORMED'" cIcon name="cil-ban"
                                                     size="md"></svg>
                                                <c-spinner *ngIf="row.scaStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Secrets" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="Secret Detection">Secrets</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                                'danger': row.secretsStatus === 'DANGER',
                                'success': row.secretsStatus === 'SUCCESS',
                                'warning': row.secretsStatus === 'WARNING',
                                'neutral': row.secretsStatus === 'NOT_PERFORMED'
                              }"
                                            >
                                                <svg *ngIf="row.secretsStatus === 'DANGER'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.secretsStatus === 'SUCCESS'" cIcon name="cil-check"
                                                     size="md"></svg>
                                                <svg *ngIf="row.secretsStatus === 'WARNING'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.secretsStatus === 'NOT_PERFORMED'" cIcon name="cil-ban"
                                                     size="md"></svg>
                                                <c-spinner *ngIf="row.secretsStatus === 'RUNNING'"
                                                           size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="IaC" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="Infrastructure as Code">IaC</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div
                                                    class="scan-status-indicator"
                                                    [ngClass]="{
                                'danger': row.iacStatus === 'DANGER',
                                'success': row.iacStatus === 'SUCCESS',
                                'warning': row.iacStatus === 'WARNING',
                                'neutral': row.iacStatus === 'NOT_PERFORMED'
                              }"
                                            >
                                                <svg *ngIf="row.iacStatus === 'DANGER'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.iacStatus === 'SUCCESS'" cIcon name="cil-check"
                                                     size="md"></svg>
                                                <svg *ngIf="row.iacStatus === 'WARNING'" cIcon name="cil-warning"
                                                     size="md"></svg>
                                                <svg *ngIf="row.iacStatus === 'NOT_PERFORMED'" cIcon name="cil-ban"
                                                     size="md"></svg>
                                                <c-spinner *ngIf="row.iacStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Cloud Scan" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="GitLab Scan">GitLab Scan</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div class="scan-status-indicator"
                                                 [ngClass]="{
             'danger': row.gitlabStatus === 'DANGER',
             'success': row.gitlabStatus === 'SUCCESS',
             'warning': row.gitlabStatus === 'WARNING',
             'neutral': row.gitlabStatus === 'NOT_PERFORMED'
           }">
                                                <svg *ngIf="row.gitlabStatus === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.gitlabStatus === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.gitlabStatus === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.gitlabStatus === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.gitlabStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Cloud Scan" [width]="100">
                                    <ng-template ngx-datatable-header-template>
                                        <span class="scan-type-header" cTooltip="Cloud Security Scan">Cloud Scan</span>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-row="row">
                                        <div class="scan-status-cell">
                                            <div class="scan-status-indicator"
                                                 [ngClass]="{
             'danger': row.cloudScanStatus === 'DANGER',
             'success': row.cloudScanStatus === 'SUCCESS',
             'warning': row.cloudScanStatus === 'WARNING',
             'neutral': row.cloudScanStatus === 'NOT_PERFORMED'
           }">
                                                <svg *ngIf="row.cloudScanStatus === 'DANGER'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.cloudScanStatus === 'SUCCESS'" cIcon name="cil-check" size="md"></svg>
                                                <svg *ngIf="row.cloudScanStatus === 'WARNING'" cIcon name="cil-warning" size="md"></svg>
                                                <svg *ngIf="row.cloudScanStatus === 'NOT_PERFORMED'" cIcon name="cil-ban" size="md"></svg>
                                                <c-spinner *ngIf="row.cloudScanStatus === 'RUNNING'" size="sm"></c-spinner>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>


                            </ngx-datatable>
                        </c-tab-panel>
                    </c-tabs-content>


                    <c-tab-panel class="p-3" [itemKey]="3" *ngIf="isAdmin">
                        <ngx-datatable
                                class="bootstrap security-table"
                                [rows]="providerRows"
                                [columns]="providerColumns"
                                [columnMode]="'force'"
                                [footerHeight]="50"
                                [headerHeight]="50"
                                [rowHeight]="'auto'"
                                [limit]="10">

                            <ngx-datatable-column name="Provider" prop="providerType" [width]="120">
                                <ng-template ngx-datatable-cell-template let-row="row">
                                    <div class="d-flex align-items-center">
                                        <svg cIcon *ngIf="row.providerType === 'GITLAB'" name="cib-gitlab" size="xl" class="me-2"></svg>
                                        <svg cIcon *ngIf="row.providerType === 'GITHUB'" name="cib-github" size="xl" class="me-2"></svg>
                                        <span class="fw-bold">{{ row.providerType }}</span>
                                    </div>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="API URL" prop="apiUrl"></ngx-datatable-column>

                            <ngx-datatable-column name="Default Team" prop="defaultTeamName"></ngx-datatable-column>

                            <ngx-datatable-column name="Last Sync" prop="lastSyncDate">
                                <ng-template ngx-datatable-cell-template let-row="row">
                                    {{ row.lastSyncDate ? (row.lastSyncDate | date:'medium') : 'Never' }}
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column name="Synced Repositories" prop="syncedRepoCount">
                                <ng-template ngx-datatable-cell-template let-row="row">
                                    {{ row.syncedRepoCount || '0' }}
                                </ng-template>
                            </ngx-datatable-column>

                        </ngx-datatable>
                    </c-tab-panel>
                </c-tabs>
            </c-card-body>
        </c-card>
    </c-col>
</c-row>

<c-modal size="xl" id="repoListModal" alignment="center" [visible]="visibleList"
         (visibleChange)="handleListRepoChange($event)">
    <c-modal-header>
        <h5 cModalTitle>Available Repositories</h5>
    </c-modal-header>
    <c-modal-body>
        <div *ngIf="isLoading" class="text-center p-5">
            <c-spinner color="primary" size="sm"></c-spinner>
            <p class="mt-3">Loading repositories...</p>
        </div>

        <ng-container *ngIf="!isLoading">
            <c-input-group class="mb-4">
        <span cInputGroupText>
          <svg cIcon name="cil-magnifying-glass"></svg>
        </span>
                <input
                        type="text"
                        class="form-control"
                        placeholder="Filter repositories..."
                        (input)="updateFilterRepo($event)"
                />
            </c-input-group>

            <ngx-datatable
                    class="bootstrap"
                    [rows]="repoRows"
                    [columnMode]="'force'"
                    [footerHeight]="50"
                    [headerHeight]="50"
                    [rowHeight]="'auto'"
                    [limit]="10"
            >
                <ngx-datatable-column name="Name" prop="name"></ngx-datatable-column>
                <ngx-datatable-column name="Namespace" prop="namespace"></ngx-datatable-column>
                <ngx-datatable-column name="URL" prop="repo_url"></ngx-datatable-column>
                <ngx-datatable-column name="Import" [width]="80" [sortable]="false">
                    <ng-template ngx-datatable-cell-template let-row="row">
                        <button *ngIf="!row.imported" cButton color="primary" size="sm" (click)="importRepo(row)">
                            <svg cIcon name="cil-cloud-download"></svg>
                        </button>
                        <button *ngIf="row.imported" cButton color="success" size="sm" disabled>
                            <svg cIcon name="cil-check"></svg>
                        </button>
                    </ng-template>
                </ngx-datatable-column>
            </ngx-datatable>
        </ng-container>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="closeModal()" cButton color="primary">Done</button>
    </c-modal-footer>
</c-modal>

<c-modal id="importRepoModal" alignment="center" [visible]="visible" (visibleChange)="handleImportRepoChange($event)">
    <c-modal-header>
        <h5 cModalTitle>Bulk Import Repositories</h5>
    </c-modal-header>
    <c-modal-body>
        <div class="alert alert-info mb-3">
            <svg cIcon name="cil-info" class="me-2"></svg>
            <strong>Bulk Import:</strong> This option allows you to browse and select multiple repositories from a Git
            provider.
        </div>

        <div class="repo-type-selector mb-4">
            <h6 class="mb-3">Select Git Provider</h6>
            <div class="d-flex justify-content-center gap-4">
                <button
                        cButton
                        type="button"
                        class="repo-type-btn"
                        [class.active]="selectedRepo === 'GitLab'"
                        (click)="selectRepoType('GitLab')"
                        cTooltip="Import from GitLab"
                        cTooltipPlacement="top"
                >
                    <svg cIcon name="cib-gitlab" size="3xl"></svg>
                    <span class="repo-type-label">GitLab</span>
                </button>
                <button
                        cButton
                        type="button"
                        class="repo-type-btn"
                        [class.active]="selectedRepo === 'GitHub'"
                        (click)="selectRepoType('GitHub')"
                        cTooltip="Import from GitHub"
                        cTooltipPlacement="top"
                >
                    <svg cIcon name="cib-github" size="3xl"></svg>
                    <span class="repo-type-label">GitHub</span>
                </button>
            </div>
        </div>

        <form [formGroup]="importRepoForm" cForm>
            <div class="mb-3">
                <label for="repoUrl" class="form-label">
                    Git Provider URL
                    <span cTooltip="The base URL of your Git provider, not a specific repository"
                          cTooltipPlacement="top" class="text-info ms-1">
                        <svg cIcon name="cil-info-circle"></svg>
                    </span>
                </label>
                <c-input-group class="has-validation">
                    <span cInputGroupText>
                        <svg cIcon name="cil-link"></svg>
                    </span>
                    <input
                            cFormControl
                            type="url"
                            id="repoUrl"
                            formControlName="repoUrl"
                            [placeholder]="selectedRepo === 'GitLab' ? 'https://gitlab.com' : 'https://github.com'"
                            required
                    />
                    <div class="invalid-feedback"
                         *ngIf="importRepoForm.get('repoUrl')?.invalid && importRepoForm.get('repoUrl')?.touched">
                        Please enter a valid URL
                    </div>
                </c-input-group>
                <small class="text-muted d-block mt-1">
                    <svg cIcon name="cil-check-circle" class="me-1 text-success" size="sm"></svg>
                    Example: <code>{{ selectedRepo === 'GitLab' ? 'https://gitlab.com' : 'https://github.com' }}</code>
                </small>
                <small class="text-muted d-block mt-1">
                    <svg cIcon name="cil-x-circle" class="me-1 text-danger" size="sm"></svg>
                    Not:
                    <code>{{ selectedRepo === 'GitLab' ? 'https://gitlab.com/namespace/project' : 'https://github.com/username/repo' }}</code>
                </small>
            </div>

            <div class="mb-3">
                <label for="accessToken" class="form-label">
                    Access Token
                    <span cTooltip="Personal access token with repository read permissions" cTooltipPlacement="top"
                          class="text-info ms-1">
                        <svg cIcon name="cil-info-circle"></svg>
                    </span>
                </label>
                <c-input-group class="has-validation">
                    <span cInputGroupText>
                        <svg cIcon name="cil-lock-locked"></svg>
                    </span>
                    <input
                            cFormControl
                            type="password"
                            id="accessToken"
                            formControlName="accessToken"
                            placeholder="Your access token"
                            required
                    />
                    <div class="invalid-feedback"
                         *ngIf="importRepoForm.get('accessToken')?.invalid && importRepoForm.get('accessToken')?.touched">
                        Access token is required
                    </div>
                </c-input-group>
                <small class="text-muted d-flex align-items-center mt-1">
                    <svg cIcon name="cil-info" class="me-1" size="sm"></svg>
                    {{ selectedRepo === 'GitLab' ? 'Create token at GitLab > Settings > Access Tokens' : 'Create token at GitHub > Settings > Developer settings > Personal access tokens' }}
                </small>
            </div>

            <div class="mb-3">
                <label for="inputGroupSelect01" class="form-label">
                    Team
                    <span cTooltip="Team that will own the imported repositories" cTooltipPlacement="top"
                          class="text-info ms-1">
                        <svg cIcon name="cil-info-circle"></svg>
                    </span>
                </label>
                <c-input-group class="has-validation">
                    <span cInputGroupText>
                        <svg cIcon name="cil-people"></svg>
                    </span>
                    <select cSelect id="inputGroupSelect01" formControlName="team" required>
                        <option value="" disabled selected>Select Team...</option>
                        <option *ngFor="let team of teams" [value]="team.id">{{ team.name }}</option>
                    </select>
                    <div class="invalid-feedback"
                         *ngIf="importRepoForm.get('team')?.invalid && importRepoForm.get('team')?.touched">
                        Please select a team
                    </div>
                </c-input-group>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="closeModal()" cButton color="secondary">Cancel</button>
        <button (click)="onSubmit()" cButton color="primary" [disabled]="importRepoForm.invalid">
            <svg cIcon name="cil-cloud-download" class="me-1"></svg>
            Browse Repositories
        </button>
    </c-modal-footer>
</c-modal>

<c-modal id="importSingleRepoModal" alignment="center" [visible]="visibleSingleRepoModal"
         (visibleChange)="handleImportSingleRepoChange($event)">
    <c-modal-header>
        <h5 cModalTitle>Import Single Repository</h5>
    </c-modal-header>
    <c-modal-body>
        <div class="alert alert-info mb-3">
            <svg cIcon name="cil-info" class="me-2"></svg>
            <strong>Single Import:</strong> This option allows you to import a specific repository by providing its
            direct URL.
        </div>

        <div class="repo-type-selector mb-4">
            <h6 class="mb-3">Select Git Provider</h6>
            <div class="d-flex justify-content-center gap-4">
                <button
                        cButton
                        type="button"
                        class="repo-type-btn"
                        [class.active]="selectedRepo === 'GitLab'"
                        (click)="selectRepoType('GitLab')"
                        cTooltip="Import from GitLab"
                        cTooltipPlacement="top"
                >
                    <svg cIcon name="cib-gitlab" size="3xl"></svg>
                    <span class="repo-type-label">GitLab</span>
                </button>
                <button
                        cButton
                        type="button"
                        class="repo-type-btn"
                        [class.active]="selectedRepo === 'GitHub'"
                        (click)="selectRepoType('GitHub')"
                        cTooltip="Import from GitHub"
                        cTooltipPlacement="top"
                >
                    <svg cIcon name="cib-github" size="3xl"></svg>
                    <span class="repo-type-label">GitHub</span>
                </button>
            </div>
        </div>

        <form [formGroup]="importSingleRepoForm" cForm>
            <div class="mb-3">
                <label for="repoUrl2" class="form-label">
                    Repository URL
                    <span cTooltip="The full URL to a specific repository" cTooltipPlacement="top"
                          class="text-info ms-1">
                        <svg cIcon name="cil-info-circle"></svg>
                    </span>
                </label>
                <c-input-group class="has-validation">
                    <span cInputGroupText>
                        <svg cIcon name="cil-link"></svg>
                    </span>
                    <input
                            cFormControl
                            type="url"
                            id="repoUrl2"
                            formControlName="repoUrl"
                            [placeholder]="selectedRepo === 'GitLab' ? 'https://gitlab.com/namespace/project' : 'https://github.com/username/repo'"
                            required
                    />
                    <div class="invalid-feedback"
                         *ngIf="importSingleRepoForm.get('repoUrl')?.invalid && importSingleRepoForm.get('repoUrl')?.touched">
                        Please enter a valid repository URL
                    </div>
                </c-input-group>
                <small class="text-muted d-block mt-1">
                    <svg cIcon name="cil-check-circle" class="me-1 text-success" size="sm"></svg>
                    Example:
                    <code>{{ selectedRepo === 'GitLab' ? 'https://gitlab.com/namespace/project' : 'https://github.com/username/repo' }}</code>
                </small>
                <small class="text-muted d-block mt-1">
                    <svg cIcon name="cil-x-circle" class="me-1 text-danger" size="sm"></svg>
                    Not: <code>{{ selectedRepo === 'GitLab' ? 'https://gitlab.com' : 'https://github.com' }}</code>
                    (base URL only)
                </small>
            </div>

            <div class="mb-3">
                <label for="accessToken2" class="form-label">
                    Access Token
                    <span cTooltip="Personal access token with repository read permissions" cTooltipPlacement="top"
                          class="text-info ms-1">
                        <svg cIcon name="cil-info-circle"></svg>
                    </span>
                </label>
                <c-input-group class="has-validation">
                    <span cInputGroupText>
                        <svg cIcon name="cil-lock-locked"></svg>
                    </span>
                    <input
                            cFormControl
                            type="password"
                            id="accessToken2"
                            formControlName="accessToken"
                            placeholder="Your access token"
                            required
                    />
                    <div class="invalid-feedback"
                         *ngIf="importSingleRepoForm.get('accessToken')?.invalid && importSingleRepoForm.get('accessToken')?.touched">
                        Access token is required
                    </div>
                </c-input-group>
                <small class="text-muted d-flex align-items-center mt-1">
                    <svg cIcon name="cil-info" class="me-1" size="sm"></svg>
                    {{ selectedRepo === 'GitLab' ? 'Create token at GitLab > Settings > Access Tokens' : 'Create token at GitHub > Settings > Developer settings > Personal access tokens' }}
                </small>
            </div>

            <div class="mb-3">
                <label for="inputGroupSelect02" class="form-label">
                    Team
                    <span cTooltip="Team that will own this repository" cTooltipPlacement="top" class="text-info ms-1">
                        <svg cIcon name="cil-info-circle"></svg>
                    </span>
                </label>
                <c-input-group class="has-validation">
                    <span cInputGroupText>
                        <svg cIcon name="cil-people"></svg>
                    </span>
                    <select cSelect id="inputGroupSelect02" formControlName="team" required>
                        <option value="" disabled selected>Select Team...</option>
                        <option *ngFor="let team of teams" [value]="team.id">{{ team.name }}</option>
                    </select>
                    <div class="invalid-feedback"
                         *ngIf="importSingleRepoForm.get('team')?.invalid && importSingleRepoForm.get('team')?.touched">
                        Please select a team
                    </div>
                </c-input-group>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="closeModal()" cButton color="secondary">Cancel</button>
        <button (click)="onSubmitSingleRepo()" cButton color="primary" [disabled]="importSingleRepoForm.invalid">
            <svg cIcon name="cil-cloud-download" class="me-1"></svg>
            Import Repository
        </button>
    </c-modal-footer>
</c-modal>
<c-modal id="newTeamModal" alignment="center" [visible]="visibleNewTeam" (visibleChange)="handleNewTeam($event)">
    <c-modal-header>
        <h5 cModalTitle>Add New Team</h5>
    </c-modal-header>
    <c-modal-body>
        <form [formGroup]="newTeamForm" cForm>
            <div class="mb-3">
                <label for="teamName" class="form-label">Team Name</label>
                <c-input-group class="has-validation">
          <span cInputGroupText>
            <svg cIcon name="cil-people"></svg>
          </span>
                    <input
                            cFormControl
                            type="text"
                            id="teamName"
                            formControlName="name"
                            placeholder="Enter team name"
                            required
                    />
                    <div class="invalid-feedback"
                         *ngIf="newTeamForm.get('name')?.invalid && newTeamForm.get('name')?.touched">
                        Team name is required
                    </div>
                </c-input-group>
            </div>

            <div class="mb-3">
                <label for="remoteIdentifier" class="form-label">Remote Identifier (Optional)</label>
                <c-input-group>
          <span cInputGroupText>
            <svg cIcon name="cil-blur"></svg>
          </span>
                    <input
                            cFormControl
                            type="text"
                            id="remoteIdentifier"
                            formControlName="remoteIdentifier"
                            placeholder="Remote identifier (optional)"
                    />
                </c-input-group>
                <small class="text-muted">Used for mapping to external systems</small>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="closeNewTeamModal()" cButton color="secondary">Cancel</button>
        <button (click)="onSubmitNewTeam()" cButton color="primary" [disabled]="newTeamForm.invalid">
            <svg cIcon name="cil-plus" class="me-1"></svg>
            Create Team
        </button>
    </c-modal-footer>
</c-modal>

<c-toaster [placement]="position" class="p-3" position="fixed">
    <c-toast
            [color]="toastStatus"
            (visibleChange)="onVisibleChange($event)"
            [visible]="visibleToast"
            [autohide]="true"
            [delay]="5000"
    >
        <c-toast-header>
            <svg cIcon name="cil-bell" class="me-2"></svg>
            <strong>Notification</strong>
        </c-toast-header>
        <c-toast-body>
            <p class="mb-0">{{ toastMessage }}</p>
        </c-toast-body>
    </c-toast>
</c-toaster>

<c-modal id="connectProviderModal" alignment="center" [visible]="visibleConnectProvider" (visibleChange)="handleConnectProviderChange($event)">
    <c-modal-header>
        <h5 cModalTitle>Connect Repository Provider</h5>
    </c-modal-header>
    <c-modal-body>
        <div class="alert alert-info">
            Connect to a Git provider to automatically discover and import all accessible repositories into a default team.
        </div>
        <form [formGroup]="connectProviderForm" cForm>
            <div class="mb-3">
                <label class="form-label">Git Provider</label>
                <div class="form-check">
                    <input class="form-check-input"
                           type="radio"
                           id="gitlabRadio"
                           name="providerType"
                           formControlName="providerType"
                           value="GITLAB">
                    <label class="form-check-label" for="gitlabRadio">GitLab</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input"
                           type="radio"
                           id="githubRadio"
                           name="providerType"
                           formControlName="providerType"
                           value="GITHUB">
                    <label class="form-check-label" for="githubRadio">GitHub</label>
                </div>
            </div>

            <div class="mb-3">
                <label for="apiUrl" class="form-label">API URL</label>
                <input cFormControl type="url" id="apiUrl" formControlName="apiUrl"
                       placeholder="e.g., https://api.github.com or https://gitlab.com" required />
            </div>

            <div class="mb-3">
                <label for="providerAccessToken" class="form-label">Access Token</label>
                <input cFormControl type="password" id="providerAccessToken" formControlName="accessToken"
                       placeholder="Provider access token" required />
            </div>

            <div class="mb-3">
                <label for="defaultTeam" class="form-label">Default Team</label>
                <select cSelect id="defaultTeam" formControlName="defaultTeamId" required>
                    <option value="" disabled selected>Assign to team...</option>
                    <option *ngFor="let team of teams" [value]="team.id">{{ team.name }}</option>
                </select>
            </div>
        </form>

    </c-modal-body>
    <c-modal-footer>
        <button (click)="closeModal()" cButton color="secondary">Cancel</button>
        <button (click)="onSubmitConnectProvider()" cButton color="primary" [disabled]="connectProviderForm.invalid">
            Connect and Sync
        </button>
    </c-modal-footer>
</c-modal>

<c-modal id="changeTeamModal" alignment="center" [visible]="visibleChangeTeamModal" (visibleChange)="handleChangeTeamModalChange($event)">
    <c-modal-header>
        <h5 cModalTitle>Change Team for Selected Repositories</h5>
    </c-modal-header>
    <c-modal-body>
        <p>You are about to change the team for <strong>{{ selectedRepos.length }}</strong> selected repositories.</p>

        <div class="mb-3">
            <small>Repositories:</small>
            <ul class="list-group list-group-flush" style="max-height: 150px; overflow-y: auto;">
                <li *ngFor="let repo of selectedRepos" class="list-group-item py-1 px-0">{{ repo.target }}</li>
            </ul>
        </div>

        <form [formGroup]="changeTeamForm" cForm>
            <div class="mb-3">
                <label for="newTeamIdSelect" class="form-label">New Team</label>
                <select cSelect id="newTeamIdSelect" formControlName="newTeamId" required>
                    <option value="" disabled selected>Select new team...</option>
                    <option *ngFor="let team of teams" [value]="team.id">{{ team.name }}</option>
                </select>
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button (click)="visibleChangeTeamModal = false" cButton color="secondary">Cancel</button>
        <button (click)="onSubmitChangeTeam()" cButton color="primary" [disabled]="changeTeamForm.invalid">
            Change Team
        </button>
    </c-modal-footer>
</c-modal>