import { Component, Input, OnChanges } from '@angular/core';
import {
  BadgeComponent,
  ColComponent,
  RowComponent
} from '@coreui/angular';
import { NgIf, NgClass } from '@angular/common';
import { IconDirective } from '@coreui/icons-angular';

@Component({
  selector: 'app-team-vulnerability-summary',
  standalone: true,
  imports: [
    RowComponent,
    ColComponent,
    BadgeComponent,
    NgIf,
    NgClass,
    IconDirective
  ],
  templateUrl: './team-vulnerability-summary.component.html',
  styleUrls: ['./team-vulnerability-summary.component.scss']
})
export class TeamVulnerabilitySummaryComponent implements OnChanges {
  @Input() counts: any;

  totalVulnerabilities: number = 0;

  ngOnChanges(): void {
    this.calculateTotal();
  }

  calculateTotal(): void {
    if (!this.counts) return;

    this.totalVulnerabilities =
        (this.counts.critical || 0) +
        (this.counts.high || 0) +
        (this.counts.rest || 0);
  }

  getPercentage(type: string): number {
    if (!this.counts || this.totalVulnerabilities === 0) return 0;

    const value = this.counts[type] || 0;
    return Math.round((value / this.totalVulnerabilities) * 100);
  }
}