<div class="d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-2">
        <h2 class="mb-0 repo-title">
            {{ repoData?.name }}
        </h2>
        <div class="scan-status">
            <c-spinner
                    *ngIf="scanRunning"
                    size="sm"
                    [cTooltip]="'Scan in progress'"
                    class="scan-spinner"
            ></c-spinner>
            <span *ngIf="scanRunning" class="scan-text ms-2">Scanning</span>
        </div>
    </div>
    <div class="repo-actions" >
        <button
                *ngIf="!scanRunning"
                cButton
                color="secondary"
                variant="ghost"
                size="sm"
                [cTooltip]="'Start a new exploitability scan'"
                (click)="analyzeExploitability()"
        >
            <svg cIcon name="cil-magnifying-glass" class="me-1"></svg>
            Analyze exploitability
        </button>
        <button
                *ngIf="!scanRunning"
                cButton
                color="info"
                variant="ghost"
                size="sm"
                [cTooltip]="'Start a new security scan'"
                (click)="runScan()"
        >
            <svg cIcon name="cil-media-play" class="me-1"></svg>
            Scan
        </button>
        <button *ngIf="userRole === 'ADMIN' || userRole === 'TEAM_MANAGER'"
                cButton
                color="primary"
                variant="ghost"
                size="sm"
                [cTooltip]="'Change repository team'"
                (click)="openChangeTeamModal()"
        >
            <svg cIcon name="cil-people" class="me-1"></svg>
            Team
        </button>
        <button *ngIf="userRole === 'ADMIN' || userRole === 'TEAM_MANAGER'"
                cButton color="warning" variant="ghost" size="sm"
                [cTooltip]="'Rename repository'"
                (click)="openRenameModal()">
            <svg cIcon name="cil-pencil" class="me-1"></svg>
            Rename
        </button>
    </div>
</div>

<c-modal [(visible)]="renameModalVisible" alignment="center" size="sm">
    <c-modal-header>
        <h5 cModalTitle>Rename repository</h5>
        <button cButtonClose (click)="renameModalVisible=false"></button>
    </c-modal-header>
    <c-modal-body>
        <label class="form-label">New name</label>
        <input cFormControl type="text" [(ngModel)]="renameForm.name" maxlength="200" />
        <small class="text-muted d-block mt-2">
            Allowed: letters, digits, space, _ . - /
        </small>
        <div *ngIf="renameError" class="text-danger mt-2">{{ renameError }}</div>
    </c-modal-body>
    <c-modal-footer>
        <button cButton color="secondary" variant="ghost" (click)="renameModalVisible=false">Cancel</button>
        <button cButton color="warning" [disabled]="renameSaving" (click)="confirmRename()">
            <c-spinner size="sm" *ngIf="renameSaving" class="me-2"></c-spinner>
            Save
        </button>
    </c-modal-footer>
</c-modal>