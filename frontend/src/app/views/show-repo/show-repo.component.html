<c-row class="d-flex align-items-stretch">
    <c-col xs="8">
        <c-card class="mb-4 h-100">
            <div
                    style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;"
            >
                <!-- Project Name -->
                <h2 style="margin-bottom: 1rem;">
                    <strong>{{ repoData?.name }}</strong> &nbsp;
                    <c-spinner
                            *ngIf="scanRunning"
                            [cTooltip]="'There is a scan currently running for this repository'"
                            style="color: #c1a7a7"
                    ></c-spinner>
                </h2>

                <button color="secondary" cButton>
                    <svg cIcon class="me-2" name="cib-github"></svg>
                    {{ repoData?.repourl }}
                </button>

                <!-- Date of Creation -->
                <small style="margin-top: 1rem;">Default branch: {{ repoData?.defaultBranch.name }}</small>
                <small style="margin-top: 1rem;">Created: {{ repoData?.insertedDate | date }}</small>
                <button
                        *ngIf="!scanRunning && (userRole === 'ADMIN' || userRole === 'TEAM_MANAGER')"
                        cButton
                        color="info"
                        shape="rounded-pill"
                        style="margin-top: 10px;"
                        (click)="runScan()"
                >
                    Run Scan
                </button>

                <br />
            </div>
            <c-card-footer>
                <c-row
                        class="d-flex justify-content-center align-items-center text-center mb-2"
                        [xl]="5"
                        [lg]="4"
                        [sm]="2"
                        [xs]="1"
                >
                    <ng-container *ngFor="let lang of topLanguages">
                        <c-col class="d-flex flex-column justify-content-center">
                            <div class="text-body-secondary">{{ lang.name }}</div>
                            <strong>({{ lang.value }}%)</strong>
                            <c-progress
                                    class="mt-2"
                                    thin
                                    [color]="lang.color"
                                    [value]="lang.value"
                                    aria-label="User visits"
                            ></c-progress>
                        </c-col>
                    </ng-container>
                </c-row>
            </c-card-footer>
        </c-card>
    </c-col>
    <c-col xs="4">
        <c-card class="mb-4 h-100">
            <c-card-header>
                Vulnerabilities source
            </c-card-header>
            <c-card-body size="large">
                <c-chart type="pie" [data]="chartPieData" [options]="options"></c-chart>
            </c-card-body>
        </c-card>
    </c-col>
</c-row>
<br />

<c-row>
    <c-col lg="4" xs="12">
        <c-widget-stat-f
                [title]="'CRITICAL Findings'"
                class="mb-3"
                color="danger"
                padding
                [value]="counts?.critical"
        >
            <ng-template cTemplateId="widgetIconTemplate">
                <svg [cIcon]="icons.cilBug" size="xl" width="24"></svg>
            </ng-template>
        </c-widget-stat-f>
    </c-col>
    <c-col lg="4" xs="12">
        <c-widget-stat-f
                [title]="'HIGH Findings'"
                class="mb-3"
                color="warning"
                padding
                [value]="counts?.high"
        >
            <ng-template cTemplateId="widgetIconTemplate">
                <svg [cIcon]="icons.cilCenterFocus" size="xl" width="24"></svg>
            </ng-template>
        </c-widget-stat-f>
    </c-col>
    <c-col lg="4" xs="12">
        <c-widget-stat-f
                [title]="'Rest Findings'"
                class="mb-3"
                color="primary"
                padding
                [value]="counts?.rest"
        >
            <ng-template cTemplateId="widgetIconTemplate">
                <svg [cIcon]="icons.cilCommentSquare" size="xl" width="24"></svg>
            </ng-template>
        </c-widget-stat-f>
    </c-col>
</c-row>

<c-row>
    <c-col class="xs-12">
        <c-tabs [activeItemKey]="0">
            <c-tabs-list variant="underline-border">
                <button cTab [itemKey]="0">
                    <svg cIcon name="cil-bug" class="me-2"></svg> Vulnerabilities
                </button>
                <button cTab [itemKey]="1">
                    <svg cIcon name="cil-chart-line" class="me-2"></svg> Statistics and Trends
                </button>
                <button cTab [itemKey]="2">
                    <svg cIcon name="cil-share-alt" class="me-2"></svg> Data Privacy
                </button>
                <button cTab [itemKey]="3">
                    <svg cIcon name="cil-puzzle" class="me-2"></svg> OpenSource Components
                </button>
                <button cTab [itemKey]="4">
                    <svg cIcon name="cil-burn" class="me-2"></svg> Notifications
                </button>
                <button cTab [itemKey]="5">
                    <svg cIcon name="cil-info" class="me-2"></svg> Additional Infos
                </button>
            </c-tabs-list>
            <c-tabs-content>
                <c-tab-panel class="p-3" [itemKey]="0">
                    <c-card>
                        <c-card-header>
                            <c-row class="align-items-center">
                                <c-col xs="auto">
                                    <label cLabel class="visually-hidden" for="autoSizingSelect">
                                        Preference
                                    </label>
                                    <select
                                            cSelect
                                            id="autoSizingSelect"
                                            class="form-select"
                                            (change)="onBranchSelect($event)"
                                    >
                                        <option>Select branch. Default: {{ repoData?.defaultBranch.name }}</option>

                                        <option *ngFor="let branch of repoData?.branches" [value]="branch.id">
                                            {{ branch.name }}
                                        </option>
                                    </select>
                                </c-col>
                                <c-col xs="auto">
                                    <c-form-check class="d-flex align-items-center">
                                        <input
                                                cFormCheckInput
                                                id="showRemoved"
                                                name="showRemoved"
                                                type="checkbox"
                                                (change)="toggleShowRemoved($event)"
                                        />
                                        <label cFormCheckLabel for="showRemoved" class="mb-0 ms-2"
                                        >Show Removed Vulnerabilities</label
                                        >
                                    </c-form-check>
                                </c-col>
                                <c-col xs="auto">
                                    <c-form-check class="d-flex align-items-center">
                                        <input
                                                cFormCheckInput
                                                id="showSuppressed"
                                                name="showSuppressed"
                                                type="checkbox"
                                                (change)="toggleShowSuppressed($event)"
                                        />
                                        <label cFormCheckLabel for="showSuppressed" class="mb-0 ms-2"
                                        >Show Suppressed Vulnerabilities</label
                                        >
                                    </c-form-check>
                                </c-col>
                                <c-col xs="auto">
                                    <button cButton color="primary" (click)="toggleBulkAction()">
                                        {{ bulkActionMode ? 'Exit Bulk Action' : 'Bulk Action' }}
                                    </button>
                                </c-col>
                            </c-row>
                        </c-card-header>
                        <c-card-body>
                            <!-- Suppress with False Positive Button -->
                            <div *ngIf="bulkActionMode" class="mb-2">
                                <button
                                        cButton
                                        color="warning"
                                        [disabled]="selectedFindings.length === 0"
                                        (click)="suppressSelectedFindings()"
                                >
                                    Suppress with False Positive
                                </button>
                            </div>

                            <ngx-datatable
                                    class="bootstrap"
                                    [rows]="filteredVulns"
                                    [columnMode]="'force'"
                                    [footerHeight]="50"
                                    [headerHeight]="80"
                                    [rowHeight]="'auto'"
                                    [limit]="15"
                            >
                                <!-- Checkbox Column -->
                                <ngx-datatable-column *ngIf="bulkActionMode" name="Select" [width]="50" [sortable]="false">
                                    <ng-template ngx-datatable-header-template>
                                        <div class="d-flex align-items-center justify-content-center">
                                            <c-form-check class="mb-0">
                                                <input cFormCheckInput type="checkbox" (change)="selectAllFindings($event)" />
                                            </c-form-check>
                                        </div>
                                    </ng-template>
                                    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                                        <div class="d-flex align-items-center justify-content-center">
                                            <c-form-check class="mb-0">
                                                <input
                                                        cFormCheckInput
                                                        type="checkbox"
                                                        [checked]="isSelected(row.id)"
                                                        (change)="onSelectFinding(row.id, $event)"
                                                />
                                            </c-form-check>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Actions" prop="name2" [width]="50" [sortable]="false">
                                    <ng-template
                                            ngx-datatable-cell-template
                                            let-rowIndex="rowIndex"
                                            let-value="value"
                                            let-row="row"
                                    >
                                        <div class="d-flex align-items-center justify-content-center">
                                            <button type="button" class="btn btn-outline-info" (click)="click(row)">
                                                <svg cIcon name="cil-magnifying-glass"></svg>
                                            </button>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Name" prop="name" [sortable]="false">
                                    <ng-template ngx-datatable-header-template>
                                        <c-input-group class="mb-3">
                      <span cInputGroupText id="filterTable">
                        <svg cIcon name="cil-magnifying-glass" class="icon"></svg>
                      </span>
                                            <input
                                                    aria-describedby="addon-wrapping"
                                                    aria-label="Access Token"
                                                    type="text"
                                                    class="form-control"
                                                    placeholder="Filter Name"
                                                    (input)="updateFilterName($event)"
                                            />
                                        </c-input-group>
                                    </ng-template>
                                    <ng-template
                                            ngx-datatable-cell-template
                                            let-rowIndex="rowIndex"
                                            let-value="value"
                                            let-row="row"
                                    >
                                        <div class="d-flex align-items-center justify-content-center">
                                            {{ row?.name }}
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Location" prop="location" [sortable]="false">
                                    <ng-template ngx-datatable-header-template>
                                        <c-input-group class="mb-3">
                      <span cInputGroupText id="filterTableLocation">
                        <svg cIcon name="cil-magnifying-glass" class="icon"></svg>
                      </span>
                                            <input
                                                    aria-describedby="addon-wrapping"
                                                    aria-label="Access Token"
                                                    type="text"
                                                    class="form-control"
                                                    placeholder="Filter Location"
                                                    (input)="updateFilterLocation($event)"
                                            />
                                        </c-input-group>
                                    </ng-template>
                                    <ng-template
                                            ngx-datatable-cell-template
                                            let-rowIndex="rowIndex"
                                            let-value="value"
                                            let-row="row"
                                    >
                                        <div class="d-flex align-items-center justify-content-center location-cell">
                                            {{ row?.location }}
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Source" prop="source" [sortable]="false">
                                    <ng-template ngx-datatable-header-template>
                                        <c-input-group class="mb-3">
                      <span cInputGroupText id="filterTableSource">
                        <svg cIcon name="cil-magnifying-glass" class="icon"></svg>
                      </span>
                                            <select class="form-control" (change)="updateFilterSource($event)">
                                                <option value="">Sources: All</option>
                                                <option value="SAST">SAST</option>
                                                <option value="IaC">IaC</option>
                                                <option value="Secrets">Secrets</option>
                                                <option value="SCA">SCA</option>
                                            </select>
                                        </c-input-group>
                                    </ng-template>
                                    <ng-template
                                            ngx-datatable-cell-template
                                            let-rowIndex="rowIndex"
                                            let-value="value"
                                            let-row="row"
                                    >
                                        <div class="d-flex align-items-center justify-content-center">
                                            <c-badge *ngIf="row?.source === 'SAST'" color="primary">SAST</c-badge>
                                            <c-badge *ngIf="row?.source === 'IAC'" color="info">IaC</c-badge>
                                            <c-badge *ngIf="row?.source === 'SECRETS'" color="danger">Secrets</c-badge>
                                            <c-badge *ngIf="row?.source === 'SCA'" color="warning">SCA</c-badge>
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Status" prop="status" [sortable]="false">
                                    <ng-template ngx-datatable-header-template>
                                        <c-input-group class="mb-3">
                      <span cInputGroupText id="filterTableStatus">
                        <svg cIcon name="cil-magnifying-glass" class="icon"></svg>
                      </span>
                                            <select class="form-control" (change)="updateFilterStatus($event)">
                                                <option value="">Statuses: All</option>
                                                <option value="New">New</option>
                                                <option value="Existing">Existing</option>
                                                <option value="Removed">Removed</option>
                                                <option value="Supressed">Suppressed</option>
                                            </select>
                                        </c-input-group>
                                    </ng-template>
                                    <ng-template
                                            ngx-datatable-cell-template
                                            let-rowIndex="rowIndex"
                                            let-value="value"
                                            let-row="row"
                                    >
                                        <div class="d-flex align-items-center justify-content-center">
                                            <svg
                                                    cIcon
                                                    *ngIf="row?.status === 'NEW'"
                                                    name="cil-burn"
                                                    class="me-2"
                                            ></svg>
                                            <svg
                                                    cIcon
                                                    *ngIf="row?.status === 'EXISTING'"
                                                    name="cil-graph"
                                                    class="me-2"
                                            ></svg>
                                            <svg
                                                    cIcon
                                                    *ngIf="row?.status === 'REMOVED'"
                                                    name="cil-trash"
                                                    class="me-2"
                                            ></svg>
                                            <svg
                                                    cIcon
                                                    *ngIf="row?.status === 'SUPRESSED'"
                                                    name="cil-volume-off"
                                                    class="me-2"
                                            ></svg>
                                            {{ row?.status }}
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Severity" prop="severity" [sortable]="false">
                                    <ng-template ngx-datatable-header-template>
                                        <c-input-group class="mb-3">
                      <span cInputGroupText id="filterTableSeverity">
                        <svg cIcon name="cil-magnifying-glass" class="icon"></svg>
                      </span>
                                            <select class="form-control" (change)="updateFilterSeverity($event)">
                                                <option value="">Severities: All</option>
                                                <option value="Critical">Critical</option>
                                                <option value="High">High</option>
                                                <option value="Medium">Medium</option>
                                                <option value="Low">Low</option>
                                                <option value="Info">Info</option>
                                            </select>
                                        </c-input-group>
                                    </ng-template>
                                    <ng-template
                                            ngx-datatable-cell-template
                                            let-rowIndex="rowIndex"
                                            let-value="value"
                                            let-row="row"
                                    >
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span *ngIf="row?.severity === 'HIGH'" class="dot high"></span>
                                            <span *ngIf="row?.severity == 'MEDIUM'" class="dot medium"></span>
                                            <span *ngIf="row?.severity == 'LOW'" class="dot low"></span>
                                            <span *ngIf="row?.severity == 'INFO'" class="dot low"></span>
                                            <c-spinner
                                                    *ngIf="row?.severity === 'CRITICAL'"
                                                    color="danger"
                                                    variant="grow"
                                                    size="sm"
                                            ></c-spinner>
                                            <span
                                                    *ngIf="row?.severity === 'HIGH'"
                                                    style="margin-left: 8px;"
                                                    class="high-t"
                                            >{{ row?.severity }}</span
                                            >
                                            <span
                                                    *ngIf="row?.severity === 'CRITICAL'"
                                                    style="margin-left: 8px;"
                                                    class="high-t"
                                            >{{ row?.severity }}</span
                                            >
                                            <span
                                                    *ngIf="row?.severity === 'MEDIUM'"
                                                    style="margin-left: 8px;"
                                                    class="medium-t"
                                            >{{ row?.severity }}</span
                                            >
                                            <span
                                                    *ngIf="row?.severity === 'LOW'"
                                                    style="margin-left: 8px;"
                                                    class="low-t"
                                            >{{ row?.severity }}</span
                                            >
                                            <span
                                                    *ngIf="row?.severity === 'INFO'"
                                                    style="margin-left: 8px;"
                                                    class="low-t"
                                            >{{ row?.severity }}</span
                                            >
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>

                                <ngx-datatable-column name="Dates" prop="inserted" [sortable]="false">
                                    <ng-template
                                            ngx-datatable-cell-template
                                            let-rowIndex="rowIndex"
                                            let-value="value"
                                            let-row="row"
                                    >
                                        <div>
                                            <strong>Inserted:</strong> {{ row?.inserted | date }} <br />
                                            <strong>Last Seen:</strong> {{ row?.last_seen | date }}
                                        </div>
                                    </ng-template>
                                </ngx-datatable-column>
                            </ngx-datatable>
                        </c-card-body>
                    </c-card>
                </c-tab-panel>
                <!-- Other tab panels remain unchanged -->
            </c-tabs-content>
        </c-tabs>
    </c-col>
</c-row>

<!-- Rest of your template remains unchanged -->

<c-modal size="lg" id="detailsModal" alignment="center" [visible]="detailsModal" (visibleChange)="handleDetailsModal($event)">
    <c-modal-header>
        <h5 cModalTitle>Vulnerability Details</h5>
    </c-modal-header>
    <c-modal-body>
        <div *ngIf="selectedRowId !== null">
            <!--<p>Vulnerability ID: {{ selectedRowId }}</p>
           Add more details about the vulnerability here -->
            <c-row>
                <c-col xs="8">
                    <c-card class="mb-4 h-100">
                        <c-card-header>
                            {{ singleVuln?.vulnsResponseDto?.name }}
                        </c-card-header>
                        <c-card-body>
                            <u><b>Location:</b></u> {{singleVuln?.vulnsResponseDto?.location}}
                        </c-card-body>
                        <c-card-footer><u><b>Status:</b></u> &nbsp;&nbsp;
                            <svg cIcon *ngIf="singleVuln?.vulnsResponseDto?.status === 'NEW'" name="cil-burn" class="me-2"></svg>
                            <svg cIcon *ngIf="singleVuln?.vulnsResponseDto?.status === 'EXISTING'" name="cil-graph" class="me-2"></svg>
                            <svg cIcon *ngIf="singleVuln?.vulnsResponseDto?.status === 'REMOVED'" name="cil-trash" class="me-2"></svg>
                            <svg cIcon *ngIf="singleVuln?.vulnsResponseDto?.status === 'SUPRESSED'" name="cil-volume-off" class="me-2"></svg>
                            {{ singleVuln?.vulnsResponseDto?.status }}

                        </c-card-footer>
                    </c-card>
                </c-col>
                <c-col xs="4">
                    <c-card class="mb-4 h-100">
                        <c-card-header>
                            <div class="d-flex align-items-center justify-content-center">
                                <span *ngIf="singleVuln?.vulnsResponseDto?.severity === 'HIGH'" class="dot high"></span>
                                <span *ngIf="singleVuln?.vulnsResponseDto?.severity == 'MEDIUM'" class="dot medium"></span>
                                <span *ngIf="singleVuln?.vulnsResponseDto?.severity == 'LOW'" class="dot low"></span>
                                <span *ngIf="singleVuln?.vulnsResponseDto?.severity == 'INFO'" class="dot low"></span>
                                <c-spinner *ngIf="singleVuln?.vulnsResponseDto?.severity === 'CRITICAL'" color="danger" variant="grow" size="sm"></c-spinner>
                                <span *ngIf="singleVuln?.vulnsResponseDto?.severity === 'HIGH'" style="margin-left: 8px;" class="high-t">{{ singleVuln?.vulnsResponseDto?.severity }}</span>
                                <span *ngIf="singleVuln?.vulnsResponseDto?.severity === 'CRITICAL'" style="margin-left: 8px;" class="high-t">{{ singleVuln?.vulnsResponseDto?.severity }}</span>
                                <span *ngIf="singleVuln?.vulnsResponseDto?.severity === 'MEDIUM'" style="margin-left: 8px;" class="medium-t">{{ singleVuln?.vulnsResponseDto?.severity }}</span>
                                <span *ngIf="singleVuln?.vulnsResponseDto?.severity === 'LOW'" style="margin-left: 8px;" class="low-t">{{ singleVuln?.vulnsResponseDto?.severity }}</span>
                                <span *ngIf="singleVuln?.vulnsResponseDto?.severity === 'INFO'" style="margin-left: 8px;" class="low-t">{{ singleVuln?.vulnsResponseDto?.severity }}</span>
                            </div>
                        </c-card-header>
                        <c-card-body size="large">
                            <u><b>Detected:</b></u> &nbsp;&nbsp; {{singleVuln?.vulnsResponseDto?.inserted | date}} <br/>
                            <u><b>Last Seen:</b></u> &nbsp;&nbsp; {{singleVuln?.vulnsResponseDto?.last_seen | date}}
                        </c-card-body>
                    </c-card>
                </c-col>
            </c-row>
            <br/>
            <c-row>
                <c-col xs="12">
                    <c-tabs [activeItemKey]="0" *ngIf="singleVuln" >
                        <c-tabs-list variant="underline-border">
                            <button cTab [itemKey]="0">Description</button>
                            <button cTab [itemKey]="1">Recommendation</button>
                            <button cTab [itemKey]="2">Explanation</button>
                            <button cTab [itemKey]="3">References</button>
                        </c-tabs-list>
                        <c-tabs-content>
                            <c-tab-panel class="p-3" [itemKey]="0" *ngIf="singleVuln">
                                <markdown [data]="singleVuln.description || 'No description available at this moment'"></markdown>
                            </c-tab-panel>
                            <c-tab-panel class="p-3" [itemKey]="1" *ngIf="singleVuln">
                                <markdown [data]="singleVuln.recommendation || 'No recommendation available at this moment'"></markdown>
                            </c-tab-panel>
                            <c-tab-panel class="p-3" [itemKey]="2" *ngIf="singleVuln">
                                <markdown [data]="singleVuln.explanation || 'No explanation available at this moment'"></markdown>
                            </c-tab-panel>
                            <c-tab-panel class="p-4" [itemKey]="3" *ngIf="singleVuln">
                                <markdown [data]="singleVuln.refs || 'No references available at this moment'"></markdown>
                            </c-tab-panel>
                        </c-tabs-content>
                    </c-tabs>
                </c-col>
            </c-row>
        </div>

    </c-modal-body>
    <c-modal-footer>
        <form *ngIf="singleVuln?.vulnsResponseDto?.status != 'SUPRESSED'" class="d-flex align-items-center" (ngSubmit)="suppressFinding()">
            <label for="suppressReason" class="me-2">Suppress finding: </label>
            <select id="suppressReason" class="form-select me-2" [(ngModel)]="suppressReason" name="suppressReason" required>
                <option *ngFor="let reason of suppressReasons" [value]="reason">{{ reason }}</option>
            </select>
            <button type="submit" cButton color="warning" class="me-2">Suppress</button>
        </form>
        <button (click)="reactivateFinding()" *ngIf="singleVuln?.vulnsResponseDto?.status == 'SUPRESSED'" type="submit" cButton color="primary" class="me-2">Re-Activate Finding</button>
        <button (click)="closeModal()" cButton color="secondary">
            Close
        </button>
    </c-modal-footer>
</c-modal>

<c-toaster [placement]="position" class="p-3" position="fixed">
    <c-toast
            [color]="toastStatus"
            (visibleChange)="onVisibleChange($event)"
            [visible]="visible">
        <c-toast-header>
            Finding management
        </c-toast-header>
        <c-toast-body>
            <p>{{toastMessage}}</p>
        </c-toast-body>
    </c-toast>
</c-toaster>
