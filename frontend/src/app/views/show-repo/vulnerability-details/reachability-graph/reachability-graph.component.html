<div class="reachability-container">
    <div class="label-left">
        <!-- Attacker Icon -->
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" class="icon-attacker">
            <path d="M12 2a5 5 0 0 1 5 5v2a5 5 0 0 1-10 0V7a5 5 0 0 1 5-5z"></path>
            <path d="M12 14a9 9 0 0 0-9 9"></path>
            <path d="M21 23a9 9 0 0 0-9-9"></path>
            <line x1="12" y1="14" x2="12" y2="14.01"></line> <!-- Simple user/attacker representation -->
        </svg>
        <span>Attacker</span>
    </div>

    <div class="graph-area">
        <svg [attr.viewBox]="'0 0 ' + width + ' ' + height" preserveAspectRatio="xMidYMid meet">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="currentColor" class="arrow-color" />
                </marker>
            </defs>

            <!-- Dead Ends (Spaghetti) -->
            <g *ngFor="let de of deadEnds">
                <path [attr.d]="de.d" fill="none" stroke="#888" stroke-width="2" class="path-line" opacity="0.6"></path>
                <!-- X Marker at end -->
                <line [attr.x1]="de.endX - 5" [attr.y1]="de.endY - 5" [attr.x2]="de.endX + 5" [attr.y2]="de.endY + 5"
                    stroke="#888" stroke-width="2" />
                <line [attr.x1]="de.endX + 5" [attr.y1]="de.endY - 5" [attr.x2]="de.endX - 5" [attr.y2]="de.endY + 5"
                    stroke="#888" stroke-width="2" />
            </g>

            <!-- Path Segments -->
            <path *ngFor="let seg of pathSegments" [attr.d]="seg.d" fill="none"
                [attr.stroke]="seg.color || 'currentColor'" [attr.stroke-width]="seg.width || 3"
                [attr.stroke-dasharray]="seg.dashed ? '10,5' : 'none'" [attr.opacity]="seg.opacity || 1"
                class="path-line" [attr.marker-end]="seg.showArrow ? 'url(#arrowhead)' : null"></path>

            <!-- Checkpoints (Gates) -->
            <g *ngFor="let cp of checkpoints" cTooltip="Additional conditions must be met" cTooltipPlacement="top">
                <!-- Gate/Barrier Icon -->
                <rect [attr.x]="cp.x - 12" [attr.y]="cp.y - 12" width="24" height="24" fill="var(--cui-body-bg)"
                    stroke="none" />
                <path
                    [attr.d]="'M ' + (cp.x-10) + ',' + (cp.y-10) + ' L ' + (cp.x-10) + ',' + (cp.y+10) + ' M ' + (cp.x+10) + ',' + (cp.y-10) + ' L ' + (cp.x+10) + ',' + (cp.y+10) + ' M ' + (cp.x-10) + ',' + (cp.y-5) + ' L ' + (cp.x+10) + ',' + (cp.y-5) + ' M ' + (cp.x-10) + ',' + (cp.y+5) + ' L ' + (cp.x+10) + ',' + (cp.y+5)"
                    stroke="var(--cui-warning)" stroke-width="3" stroke-linecap="round" />
            </g>

            <!-- Unknown Cloud / Disconnect -->
            <g *ngIf="showCloud">
                <path d="M 260,60 Q 280,40 300,60 T 340,60 T 360,90 T 340,120 T 300,120 T 260,120 T 240,90 T 260,60 Z"
                    fill="var(--cui-secondary-bg)" stroke="currentColor" stroke-width="1" opacity="0.8" />
                <text x="300" y="95" text-anchor="middle" fill="currentColor" font-size="24" font-weight="bold">?</text>
                <text x="300" y="140" text-anchor="middle" fill="currentColor" font-size="12">Unknown
                    Reachability</text>
            </g>
        </svg>
    </div>

    <div class="label-right">
        <!-- App/Server Icon with Bug -->
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" class="icon-app">
            <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
            <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
            <line x1="6" y1="6" x2="6.01" y2="6"></line>
            <line x1="6" y1="18" x2="6.01" y2="18"></line>
            <!-- Bug Icon Overlay -->
            <circle cx="18" cy="18" r="5" fill="var(--cui-danger)" stroke="none" />
            <path d="M16 16l4 4m0-4l-4 4" stroke="white" stroke-width="1.5" />
        </svg>
        <span>Application</span>
    </div>
</div>