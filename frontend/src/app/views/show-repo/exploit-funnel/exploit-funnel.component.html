<div class="exploit-funnel-container">

    <div class="funnel-horizontal">
        <!-- Background SVG Layer -->
        <div class="funnel-svg-container">
            <svg width="100%" height="100%" preserveAspectRatio="none" viewBox="0 0 100 100">
                <!-- Layer 1: Total (Other) - Blueish -->
                <path [attr.d]="pathTotal" class="funnel-path path-total" vector-effect="non-scaling-stroke"></path>

                <!-- Layer 2: High + Critical - Orange/Yellow -->
                <path [attr.d]="pathHigh" class="funnel-path path-high" vector-effect="non-scaling-stroke"></path>

                <!-- Layer 3: Critical - Red -->
                <path [attr.d]="pathCritical" class="funnel-path path-critical" vector-effect="non-scaling-stroke">
                </path>
            </svg>
        </div>

        <!-- Foreground Content Layer -->
        <div class="funnel-content">
            <div class="funnel-item" *ngFor="let step of steps; let i = index" (mouseenter)="onStepHover(i)"
                (mouseleave)="onStepLeave()" (mousemove)="onMouseMove($event)">
                <div class="funnel-info">
                    <span class="funnel-label">
                        {{ step.label }}:
                    </span>
                    <span class="margin-left-5 funnel-value">{{ step.value | number }}</span>

                    <!-- Tooltip for Breakdown -->
                    <div class="funnel-tooltip" *ngIf="hoveredStepIndex === i" [style.left.px]="tooltipPosition.x + 15"
                        [style.top.px]="tooltipPosition.y + 15">
                        <div class="tooltip-header">
                            <strong>{{ step.label }}</strong>
                        </div>
                        <div class="tooltip-row critical">
                            <span class="dot"></span> Critical: <strong>{{ step.breakdown.critical }}</strong>
                        </div>
                        <div class="tooltip-row high">
                            <span class="dot"></span> High: <strong>{{ step.breakdown.high }}</strong>
                        </div>
                        <div class="tooltip-row other">
                            <span class="dot"></span> Other: <strong>{{ step.breakdown.other }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="funnel-header">
        <div class="legend">
            <span class="legend-item"><span class="dot critical"></span>Critical</span>
            <span class="legend-item"><span class="dot high"></span>High</span>
            <span class="legend-item"><span class="dot other"></span>Other</span>
        </div>
    </div>
</div>